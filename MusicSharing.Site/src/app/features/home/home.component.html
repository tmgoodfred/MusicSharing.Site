<div>
  <h1 class="text-2xl font-bold mb-6">Activity Feed</h1>

  <div *ngIf="activities.length === 0" class="text-center py-8">
    <p class="text-gray-500">No activity to show yet.</p>
  </div>

  <div *ngIf="activities.length > 0" class="space-y-4">
    <div *ngFor="let activity of activities"
         class="p-4 bg-card-background rounded-lg shadow">
      <div class="flex items-start">
        <div class="flex-shrink-0">
          <!-- Avatar (links to profile when available and not anonymous) -->
          <ng-container *ngIf="activity.user && !isAnonymousComment(activity); else anonymousOrNoLink">
            <a [routerLink]="['/profile', activity.user.id]" class="block">
              <div class="w-10 h-10 rounded-full bg-primary flex items-center justify-center text-white overflow-hidden">
                <img *ngIf="activity.user.profilePicturePath"
                     [src]="getProfilePictureUrl(activity.user.id)"
                     alt="{{ activity.user.username }}"
                     class="w-full h-full object-cover">
                <span *ngIf="!activity.user.profilePicturePath">{{ getUserInitial(activity.user.username) }}</span>
              </div>
            </a>
          </ng-container>
          <ng-template #anonymousOrNoLink>
            <div class="w-10 h-10 rounded-full bg-primary flex items-center justify-center text-white overflow-hidden">
              <span>A</span>
            </div>
          </ng-template>
        </div>

        <div class="ml-4 flex-1">
          <!-- Username (links to profile when available and not anonymous) -->
          <p class="font-medium">
            <ng-container *ngIf="activity.user && !isAnonymousComment(activity); else anonymousOrUnknownUser">
              <a [routerLink]="['/profile', activity.user.id]" class="hover:text-primary">
                {{ activity.user.username }}
              </a>
            </ng-container>
            <ng-template #anonymousOrUnknownUser>
              {{ isAnonymousComment(activity) ? 'Anonymous' : (activity.user?.username || 'Unknown user') }}
            </ng-template>
          </p>

          <p class="text-sm text-gray-500">{{ formatActivityType(activity) }}</p>
          <p class="text-xs text-gray-400">{{ formatDate(activity.createdAt) }}</p>

          <!-- Link to target song/blog when available -->
          <ng-container *ngIf="getTargetInfo(activity) as target">
            <div class="text-sm mt-1">
              <a [routerLink]="target.link" class="text-primary hover:text-opacity-80">
                {{ target.title || (target.kind === 'song' ? 'View song' : 'View post') }}
              </a>
            </div>
          </ng-container>

          <!-- Render comment text for comment activities -->
          <p *ngIf="activity.type === 'Comment'" class="mt-2 text-sm text-gray-700 dark:text-gray-300">
            "{{ commentTexts[activity.id] || '...' }}"
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
